<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">



  <meta name="google-site-verification" content="Lbqbq-u0Mn24a7n3Er0wVtGF9AUxR-o_FZsCOl4YEOQ">














  
  
  <link href="/libs/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  

  
    
      
    

    
  

  
    
      
    

    
  

  
    
      
    

    
  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic|Lucida Grande:300,300italic,400,400italic,700,700italic|Zapfino:300,300italic,400,400italic,700,700italic|Monaco:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/libs/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/avatar1.jpg?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/avatar1.jpg?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/avatar1.jpg?v=5.1.4">


  <link rel="mask-icon" href="/images/avatar1.jpg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, Levi">





  <link rel="alternate" href="/atom.xml" title="Levi's blog" type="application/atom+xml">






<meta name="description" content="Shareness make me happy">
<meta property="og:type" content="website">
<meta property="og:title" content="Levi&#39;s blog">
<meta property="og:url" content="http://leviduan.com/index.html">
<meta property="og:site_name" content="Levi&#39;s blog">
<meta property="og:description" content="Shareness make me happy">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Levi&#39;s blog">
<meta name="twitter:description" content="Shareness make me happy">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: false,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://leviduan.com/">





  <title>Levi's blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta custom-logo">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Levi's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description"></h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-time">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-calendar"></i> <br>
            
            Time
          </a>
        </li>
      
        
        <li class="menu-item menu-item-ios">
          <a href="/categories/iOS/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-apple"></i> <br>
            
            iOS
          </a>
        </li>
      
        
        <li class="menu-item menu-item-react-n.">
          <a href="/categories/web/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-html5"></i> <br>
            
            React N.
          </a>
        </li>
      
        
        <li class="menu-item menu-item-algorithm">
          <a href="/categories/Algorithm/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br>
            
            Algorithm
          </a>
        </li>
      
        
        <li class="menu-item menu-item-idea">
          <a href="/categories/Idea/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-music"></i> <br>
            
            Idea
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://leviduan.com/2020/06/04/2020-06-04/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Levi Duan">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Levi's blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/06/04/2020-06-04/" itemprop="url">React native - Push Notification (Firebase)</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-06-04T15:50:02+08:00">
                2020-06-04
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web/" itemprop="url" rel="index">
                    <span itemprop="name">web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/06/04/2020-06-04/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020/06/04/2020-06-04/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>How to add Push Notification in your project? I use firebase to send cloud message by Push Notification. First of all you click the website “<a href="https://rnfirebase.io/&quot;" target="_blank" rel="noopener">https://rnfirebase.io/&quot;</a> , and click menu “Cloud Messaging”</p>
<h3 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># Install &amp; setup the app module</span><br><span class="line">yarn add @react-native-firebase/app</span><br><span class="line"></span><br><span class="line"># Install the messaging module</span><br><span class="line">yarn add @react-native-firebase/messaging</span><br><span class="line"></span><br><span class="line"># If you&apos;re developing your app using iOS, run this command</span><br><span class="line">cd ios/ &amp;&amp; pod install</span><br></pre></td></tr></table></figure>
<h3 id="iOS-Setup"><a href="#iOS-Setup" class="headerlink" title="iOS Setup"></a>iOS Setup</h3><p>AppDelegate.m</p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@import</span> Firebase;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">AppDelegate</span> () &lt;<span class="title">FIRMessagingDelegate</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">AppDelegate</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">BOOL</span>)application:(<span class="built_in">UIApplication</span> *)application didFinishLaunchingWithOptions:(<span class="built_in">NSDictionary</span> *)launchOptions</span><br><span class="line">&#123;</span><br><span class="line">    [FIRApp configure];</span><br><span class="line">    [application registerForRemoteNotifications];</span><br><span class="line">    [FIRMessaging messaging].delegate = <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>) messaging:(FIRMessaging *)messaging didReceiveRegistrationToken:(<span class="built_in">NSString</span> *)fcmToken &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"FCM registration token: %@"</span>, fcmToken);</span><br><span class="line">    <span class="comment">// Notify about received token.</span></span><br><span class="line">    <span class="built_in">NSDictionary</span> *dataDict = [<span class="built_in">NSDictionary</span> dictionaryWithObject:fcmToken forKey:<span class="string">@"token"</span>];</span><br><span class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] postNotificationName:</span><br><span class="line">     <span class="string">@"FCMToken"</span> object:<span class="literal">nil</span> userInfo:dataDict];</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> If necessary send token to application server.</span></span><br><span class="line">    <span class="comment">// Note: This callback is fired at each app startup and whenever a new token is generated.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)application:(<span class="built_in">UIApplication</span> *)application didFailToRegisterForRemoteNotificationsWithError:(<span class="built_in">NSError</span> *)error &#123;</span><br><span class="line">  <span class="built_in">NSLog</span>(<span class="string">@"error: %@"</span>, error);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Android-Setup"><a href="#Android-Setup" class="headerlink" title="Android Setup"></a>Android Setup</h3><p>/appName/android/app/src/main/AndroidManifest.xml</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;service android:name=<span class="string">".MyFirebaseMessagingService"</span> android:exported=<span class="string">"false"</span>&gt;</span><br><span class="line">    &lt;intent-filter&gt;</span><br><span class="line">        &lt;action android:name=<span class="string">"com.google.firebase.MESSAGING_EVENT"</span> /&gt;</span><br><span class="line">    &lt;/intent-filter&gt;</span><br><span class="line">&lt;/service&gt;</span><br></pre></td></tr></table></figure>
<p>/android/app/src/main/java/com/appName/MyFirebaseMessagingService.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.stylepedia;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.google.firebase.messaging.FirebaseMessagingService;</span><br><span class="line"><span class="keyword">import</span> com.google.firebase.messaging.RemoteMessage;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyFirebaseMessagingService</span> <span class="keyword">extends</span> <span class="title">FirebaseMessagingService</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String TAG = <span class="string">"FCMDemo"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessageReceived</span><span class="params">(RemoteMessage remoteMessage)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// TODO(developer): Handle FCM messages here.</span></span><br><span class="line">        Log.d(TAG, <span class="string">"From: "</span> + remoteMessage.getFrom());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (remoteMessage.getData().size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            Log.d(TAG, <span class="string">"Message data payload: "</span> + remoteMessage.getData());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Check if message contains a notification payload.</span></span><br><span class="line">        <span class="keyword">if</span> (remoteMessage.getNotification() != <span class="keyword">null</span>) &#123;</span><br><span class="line">            Log.d(TAG, <span class="string">"Message Notification Body: "</span> + remoteMessage.getNotification().getBody());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Also if you intend on generating your own notifications as a result of a received FCM</span></span><br><span class="line">        <span class="comment">// message, here is where that should be initiated. See sendNotification method below.</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">sendRegistrationToServer</span><span class="params">(String token)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> Implement this method to send token to your app server.</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNewToken</span><span class="params">(String token)</span> </span>&#123;</span><br><span class="line">        Log.d(TAG, <span class="string">"From: "</span> + token);</span><br><span class="line">        sendRegistrationToServer(token);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="React-Native"><a href="#React-Native" class="headerlink" title="React Native"></a>React Native</h3><p>You can get token by this function, if the device didn’t open Push Notification, you won’t get the token, so you make sure that the user have opened the notifications.</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> messaging <span class="keyword">from</span> <span class="string">'@react-native-firebase/messaging'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!messaging().isDeviceRegisteredForRemoteMessages) &#123;</span><br><span class="line">    messaging().registerDeviceForRemoteMessages()</span><br><span class="line">&#125;</span><br><span class="line">messaging().getToken()</span><br><span class="line">.then(<span class="function"><span class="params">fcmToken</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (fcmToken) &#123;</span><br><span class="line">    <span class="built_in">console</span>.warn(fcmToken)</span><br><span class="line">    <span class="keyword">if</span> (Platform.OS === <span class="string">'ios'</span>) &#123;</span><br><span class="line">      <span class="keyword">this</span>.iosTokenNetWork(fcmToken)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.androidTokenNetWork(fcmToken)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.warn(<span class="string">'user doesn t have a device token yet'</span>)</span><br><span class="line">    <span class="comment">// user doesn't have a device token yet</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>You can use this function to check if user open the push notification switch in user’s device.</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">messaging().requestPermission().then(<span class="function">(<span class="params">response: any</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// if user click allow app push notification on pop-up，I can get token by function: </span></span><br><span class="line"></span><br><span class="line">messaging().requestPermission().then(<span class="function">(<span class="params">response: any</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!messaging().isDeviceRegisteredForRemoteMessages) &#123;</span><br><span class="line">        messaging().registerDeviceForRemoteMessages()</span><br><span class="line">      &#125;</span><br><span class="line">      messaging().getToken()</span><br><span class="line">        .then(<span class="function"><span class="params">fcmToken</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (fcmToken) &#123;</span><br><span class="line">            <span class="keyword">if</span> (Platform.OS === <span class="string">'ios'</span>) &#123;</span><br><span class="line">              <span class="keyword">this</span>.iosTokenNetWork(fcmToken)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="keyword">this</span>.androidTokenNetWork(fcmToken)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.warn(<span class="string">'user doesn t have a device token yet'</span>)</span><br><span class="line">            <span class="comment">// user doesn't have a device token yet</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>You can click Push notification and go to another page when the App is in the background.</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">messaging().setBackgroundMessageHandler(<span class="keyword">async</span> remoteMessage =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (remoteMessage) &#123;</span><br><span class="line">          appsFlyer.trackEvent(<span class="string">"Open_notification"</span>)</span><br><span class="line">          analytics().logEvent(<span class="string">'Open_notification'</span>, &#123;</span><br><span class="line">            value: <span class="string">''</span>,</span><br><span class="line">          &#125;);</span><br><span class="line">          <span class="keyword">if</span> (remoteMessage.data.send_user_history_id) &#123;</span><br><span class="line">            <span class="keyword">this</span>.pushRequest(remoteMessage.data.send_user_history_id)</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">if</span> (remoteMessage.data.url === <span class="string">"MixMatch"</span>) &#123;  </span><br><span class="line">              <span class="keyword">this</span>.props.navigation.push(<span class="string">'MyClosetDetailPage'</span>, &#123;</span><br><span class="line">                product_id: remoteMessage.data.push_id,</span><br><span class="line">                returnPage: <span class="string">'Tabs'</span>,</span><br><span class="line">              &#125;)</span><br><span class="line">  </span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">if</span> (remoteMessage.data.url === <span class="string">"StreetSnap"</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.timer = setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">              <span class="keyword">this</span>.props.navigation.navigate(<span class="string">'PushlookbookStreetSnapPage'</span>, &#123;</span><br><span class="line">                streetId: remoteMessage.data.push_id,</span><br><span class="line">                returnPage: <span class="string">'Tabs'</span>,</span><br><span class="line">              &#125;)</span><br><span class="line">            &#125;, <span class="number">500</span>);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>You can click Push notification and go to another page when the App is closed</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">messaging()</span><br><span class="line">      .getInitialNotification()</span><br><span class="line">      .then(<span class="function"><span class="params">remoteMessage</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (remoteMessage) &#123;</span><br><span class="line">          appsFlyer.trackEvent(<span class="string">"Open_notification"</span>)</span><br><span class="line">          analytics().logEvent(<span class="string">'Open_notification'</span>, &#123;</span><br><span class="line">            value: <span class="string">''</span>,</span><br><span class="line">          &#125;);</span><br><span class="line">          <span class="comment">// alert(JSON.stringify(remoteMessage) )</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (remoteMessage.data.url === <span class="string">"MixMatch"</span>) &#123;</span><br><span class="line"></span><br><span class="line">              <span class="keyword">this</span>.timer = setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">this</span>.props.navigation.push(<span class="string">'MyClosetDetailPage'</span>, &#123;</span><br><span class="line">                  product_id: remoteMessage.data.push_id,</span><br><span class="line">                  returnPage: <span class="string">'Tabs'</span>,</span><br><span class="line">                &#125;)</span><br><span class="line">              &#125;, <span class="number">500</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (remoteMessage.data.url === <span class="string">"StreetSnap"</span>) &#123;</span><br><span class="line">              <span class="keyword">this</span>.timer = setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">this</span>.props.navigation.navigate(<span class="string">'PushlookbookStreetSnapPage'</span>, &#123;</span><br><span class="line">                  streetId: remoteMessage.data.push_id,</span><br><span class="line">                  returnPage: <span class="string">'Tabs'</span>,</span><br><span class="line">                &#125;)</span><br><span class="line">              &#125;, <span class="number">500</span>);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="Create-Notification-Service-Extension"><a href="#Create-Notification-Service-Extension" class="headerlink" title="Create Notification Service Extension"></a>Create Notification Service Extension</h3><p>If I want to send an iOS Push Notification with picture to my iPhone, I have to add the iOS Push Notification with Notification Service Extension.</p>
<ol>
<li>In the Xcode menu, go to File &gt; New &gt; Target.</li>
<li>Select the Notification Service Extension.</li>
<li>Gives the name the Extension service and click the finish button.</li>
</ol>
<p>and enable Push Notification and App Group capabilities in iOS App target.</p>
<p>NotificationService.h</p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;UserNotifications/UserNotifications.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">NotificationService</span> : <span class="title">UNNotificationServiceExtension</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>NotificationService.m<br><figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"NotificationService.h"</span></span></span><br><span class="line"><span class="keyword">@import</span> Firebase;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">NotificationService</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="keyword">void</span> (^contentHandler)(UNNotificationContent *contentToDeliver);</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) UNMutableNotificationContent *bestAttemptContent;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">NotificationService</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)didReceiveNotificationRequest:(UNNotificationRequest *)request withContentHandler:(<span class="keyword">void</span> (^)(UNNotificationContent * _Nonnull))contentHandler &#123;</span><br><span class="line">    <span class="keyword">self</span>.contentHandler = contentHandler;</span><br><span class="line">    <span class="keyword">self</span>.bestAttemptContent = [request.content mutableCopy];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Modify the notification content here...</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">self</span>.bestAttemptContent.title) &#123;</span><br><span class="line">    <span class="keyword">self</span>.bestAttemptContent.title = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%@"</span>, <span class="keyword">self</span>.bestAttemptContent.title];</span><br><span class="line">  &#125;</span><br><span class="line">  [[FIRMessaging extensionHelper] populateNotificationContent:<span class="keyword">self</span>.bestAttemptContent</span><br><span class="line">  withContentHandler:contentHandler];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)serviceExtensionTimeWillExpire &#123;</span><br><span class="line">    <span class="comment">// Called just before the extension will be terminated by the system.</span></span><br><span class="line">    <span class="comment">// Use this as an opportunity to deliver your "best attempt" at modified content, otherwise the original push payload will be used.</span></span><br><span class="line">    <span class="keyword">self</span>.contentHandler(<span class="keyword">self</span>.bestAttemptContent);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure></p>
<h3 id="The-format-of-Push-Notification-Service-be-sent-by-Server"><a href="#The-format-of-Push-Notification-Service-be-sent-by-Server" class="headerlink" title="The format of Push Notification Service be sent by Server"></a>The format of Push Notification Service be sent by Server</h3><p>The content of data can be added or deleted with costume way. if your android device click the push notification bar, and then the app is not opened, the problem must be caused by the format of Push Notification Service. iOS as well.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;message&quot;: &#123;</span><br><span class="line">    &quot;notification&quot;: &#123;</span><br><span class="line">      &quot;title&quot;: &quot;title&quot;,</span><br><span class="line">      &quot;body&quot;: &quot;message content&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;token&quot;: &quot;fi7FrXMCFeQ:APA91bEZ3CCZEu6NJCzPNyOXq3QoGuCgZ_NZ6pSkuvAYM-VKTvfj1FbnBQKimHaOVqWv_4FD_eGZn1CcfNRf2Ve6X4_mYNwmgI99A1ngxcnY6oyjXTcNRsdIh7YD3SizhRHoTbIXcn-8&quot;,</span><br><span class="line">    &quot;data&quot;: &#123;</span><br><span class="line">      &quot;image_url&quot;: &quot;&quot;,</span><br><span class="line">      &quot;push_type&quot;: &quot;0&quot;,</span><br><span class="line">      &quot;type&quot;: &quot;0&quot;,</span><br><span class="line">      &quot;url&quot;: &quot;MixMatch&quot;,</span><br><span class="line">      &quot;push_id&quot;: &quot;6587588&quot;,</span><br><span class="line">      &quot;send_user_history_id&quot;: &quot;&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;apns&quot;: &#123;</span><br><span class="line">      &quot;headers&quot;: &#123;</span><br><span class="line">        &quot;apns-priority&quot;: &quot;10&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;payload&quot;: &#123;</span><br><span class="line">        &quot;aps&quot;: &#123;</span><br><span class="line">          &quot;badge&quot;: 1,</span><br><span class="line">          &quot;mutable-content&quot;: 1</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;fcm_options&quot;: &#123;</span><br><span class="line">        &quot;image&quot;: &quot;&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Detecting-that-notification-is-open-or-closed-when-app-is-in-foreground-or-background"><a href="#Detecting-that-notification-is-open-or-closed-when-app-is-in-foreground-or-background" class="headerlink" title="Detecting that notification is open or closed when app is in foreground or background."></a>Detecting that notification is open or closed when app is in foreground or background.</h3><p>if we need to detect when our app is coming to the foreground or when it comes to background, the AppState will help me to do it so easy:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> NotificationManager <span class="keyword">from</span> <span class="string">'react-native-check-notification-enable'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">        loginShow: <span class="literal">false</span>,</span><br><span class="line">        loginStatus: <span class="literal">false</span>,</span><br><span class="line">        isEnabled: <span class="literal">false</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.flage = <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">componentDidMount() &#123;</span><br><span class="line">    AppState.addEventListener(<span class="string">'change'</span>,<span class="keyword">this</span>._handleAppStateChange)</span><br><span class="line">    <span class="keyword">this</span>._navListener = <span class="keyword">this</span>.props.navigation.addListener(<span class="string">'didFocus'</span>, () =&gt; &#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (Platform.OS === <span class="string">'ios'</span>) &#123;</span><br><span class="line">        messaging().requestPermission().then(<span class="function">(<span class="params">response: any</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (response === <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">this</span>.setState(<span class="function"><span class="params">prevState</span> =&gt;</span> (&#123;</span><br><span class="line">                    isEnabled: <span class="literal">true</span></span><br><span class="line">                &#125;))</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">this</span>.setState(<span class="function"><span class="params">prevState</span> =&gt;</span> (&#123;</span><br><span class="line">                    isEnabled: <span class="literal">false</span></span><br><span class="line">                &#125;))</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">        NotificationManager.areNotificationsEnabled().then(<span class="function">(<span class="params">e</span>)=&gt;</span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (e === <span class="literal">true</span>) &#123;</span><br><span class="line">                <span class="keyword">this</span>.setState(<span class="function"><span class="params">prevState</span> =&gt;</span> (&#123;</span><br><span class="line">                    isEnabled: <span class="literal">true</span></span><br><span class="line">                &#125;))</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">this</span>.setState(<span class="function"><span class="params">prevState</span> =&gt;</span> (&#123;</span><br><span class="line">                    isEnabled: <span class="literal">false</span></span><br><span class="line">                &#125;))</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;).catch(<span class="function">(<span class="params">e</span>)=&gt;</span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.setState(<span class="function"><span class="params">prevState</span> =&gt;</span> (&#123;</span><br><span class="line">                isEnabled: <span class="literal">false</span></span><br><span class="line">            &#125;))</span><br><span class="line">          &#125;)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">_handleAppStateChange = <span class="function">(<span class="params">nextAppState</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (nextAppState != <span class="literal">null</span> &amp;&amp; nextAppState === <span class="string">'active'</span>) &#123;</span><br><span class="line">        <span class="comment">//如果是true ，表示从后台进入了前台 ，请求数据，刷新页面。或者做其他的逻辑</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.flage) &#123;</span><br><span class="line">            <span class="keyword">if</span> (Platform.OS === <span class="string">'ios'</span>) &#123;</span><br><span class="line">                messaging().requestPermission().then(<span class="function">(<span class="params">response: any</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (response === <span class="number">1</span>) &#123;</span><br><span class="line">                        <span class="keyword">this</span>.setState(<span class="function"><span class="params">prevState</span> =&gt;</span> (&#123;</span><br><span class="line">                            isEnabled: <span class="literal">true</span></span><br><span class="line">                        &#125;))</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">this</span>.setState(<span class="function"><span class="params">prevState</span> =&gt;</span> (&#123;</span><br><span class="line">                            isEnabled: <span class="literal">false</span></span><br><span class="line">                        &#125;))</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                NotificationManager.areNotificationsEnabled().then(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (e === <span class="literal">true</span>) &#123;</span><br><span class="line">                        <span class="keyword">this</span>.setState(<span class="function"><span class="params">prevState</span> =&gt;</span> (&#123;</span><br><span class="line">                            isEnabled: <span class="literal">true</span></span><br><span class="line">                        &#125;))</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">this</span>.setState(<span class="function"><span class="params">prevState</span> =&gt;</span> (&#123;</span><br><span class="line">                            isEnabled: <span class="literal">false</span></span><br><span class="line">                        &#125;))</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;).catch(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">this</span>.setState(<span class="function"><span class="params">prevState</span> =&gt;</span> (&#123;</span><br><span class="line">                        isEnabled: <span class="literal">false</span></span><br><span class="line">                    &#125;))</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.flage = <span class="literal">false</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (nextAppState != <span class="literal">null</span> &amp;&amp; nextAppState === <span class="string">'background'</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.flage = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">_handleAppStateChange = <span class="function">(<span class="params">nextAppState</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (nextAppState != <span class="literal">null</span> &amp;&amp; nextAppState === <span class="string">'active'</span>) &#123;</span><br><span class="line">        <span class="comment">//如果是true ，表示从后台进入了前台 ，请求数据，刷新页面。或者做其他的逻辑</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.flage) &#123;</span><br><span class="line">            <span class="keyword">if</span> (Platform.OS === <span class="string">'ios'</span>) &#123;</span><br><span class="line">                messaging().requestPermission().then(<span class="function">(<span class="params">response: any</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (response === <span class="number">1</span>) &#123;</span><br><span class="line">                        <span class="keyword">this</span>.setState(<span class="function"><span class="params">prevState</span> =&gt;</span> (&#123;</span><br><span class="line">                            isEnabled: <span class="literal">true</span></span><br><span class="line">                        &#125;))</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">this</span>.setState(<span class="function"><span class="params">prevState</span> =&gt;</span> (&#123;</span><br><span class="line">                            isEnabled: <span class="literal">false</span></span><br><span class="line">                        &#125;))</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                NotificationManager.areNotificationsEnabled().then(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (e === <span class="literal">true</span>) &#123;</span><br><span class="line">                        <span class="keyword">this</span>.setState(<span class="function"><span class="params">prevState</span> =&gt;</span> (&#123;</span><br><span class="line">                            isEnabled: <span class="literal">true</span></span><br><span class="line">                        &#125;))</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">this</span>.setState(<span class="function"><span class="params">prevState</span> =&gt;</span> (&#123;</span><br><span class="line">                            isEnabled: <span class="literal">false</span></span><br><span class="line">                        &#125;))</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;).catch(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">this</span>.setState(<span class="function"><span class="params">prevState</span> =&gt;</span> (&#123;</span><br><span class="line">                        isEnabled: <span class="literal">false</span></span><br><span class="line">                    &#125;))</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.flage = <span class="literal">false</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (nextAppState != <span class="literal">null</span> &amp;&amp; nextAppState === <span class="string">'background'</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.flage = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://leviduan.com/2020/01/10/2020-01-10/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Levi Duan">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Levi's blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/10/2020-01-10/" itemprop="url">React native - React-native-image-crop-picker</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-01-10T09:40:02+08:00">
                2020-01-10
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web/" itemprop="url" rel="index">
                    <span itemprop="name">web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/01/10/2020-01-10/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020/01/10/2020-01-10/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Have a function to upload your picture to find similar items about your dress, I find some similar React Native Library with support for camera, multiple images and cropping, however I found <code>React-native-image-crop-picker</code> is so adapt for my project.</p>
<p>So I use <code>React-native-image-crop-picker</code> to achieve this function, however some invisible bugs you will change the library code. I wrote it in the article.</p>
<h3 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm i react-native-image-crop-picker --save</span><br><span class="line">react-native link react-native-image-crop-picker</span><br><span class="line">cd ios &amp;&amp; pod install &amp;&amp; cd ../</span><br></pre></td></tr></table></figure>
<h3 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h3><h4 id="Select-from-gallery"><a href="#Select-from-gallery" class="headerlink" title="Select from gallery"></a>Select from gallery</h4><p>Call single image picker with cropping</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">ImagePicker.openPicker(&#123;</span><br><span class="line">  width: <span class="number">300</span>,</span><br><span class="line">  height: <span class="number">400</span>,</span><br><span class="line">  cropping: <span class="literal">true</span></span><br><span class="line">&#125;).then(<span class="function"><span class="params">image</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(image);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>Call multiple image picker</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">ImagePicker.openPicker(&#123;</span><br><span class="line">  multiple: <span class="literal">true</span></span><br><span class="line">&#125;).then(<span class="function"><span class="params">images</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(images);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="Select-from-camera"><a href="#Select-from-camera" class="headerlink" title="Select from camera"></a>Select from camera</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">ImagePicker.openCamera(&#123;</span><br><span class="line">  width: <span class="number">300</span>,</span><br><span class="line">  height: <span class="number">400</span>,</span><br><span class="line">  cropping: <span class="literal">true</span>,</span><br><span class="line">&#125;).then(<span class="function"><span class="params">image</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(image);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="Crop-picture"><a href="#Crop-picture" class="headerlink" title="Crop picture"></a>Crop picture</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">ImagePicker.openCropper(&#123;</span><br><span class="line">  path: <span class="string">'my-file-path.jpg'</span>,</span><br><span class="line">  width: <span class="number">300</span>,</span><br><span class="line">  height: <span class="number">400</span></span><br><span class="line">&#125;).then(<span class="function"><span class="params">image</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(image);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="Usage-1"><a href="#Usage-1" class="headerlink" title="Usage"></a>Usage</h3><p>When I use <code>ImagePicker.openPicker</code> in Android device，I can modify width and height to 1200/1600 as 3:4 ,I saw poor image quality using 300x400, when I upped it to 1200x1600 the quality greatly improved. I’d say the solution is to set a greater height/width, Android can do it very well, but if you use iPhone, when you upped it to 1200x1600 the picture, you found you cropped the area will be error area.</p>
<p>In Android it is working properly and I’m able to crop the image. However, on iOS the crop is not properly cropping the required region.</p>
<p>So how to resolve it?</p>
<p>We will open Xcode,  and search the path:  Pods - Development Pods - RNImageCropPicker - ImageCropPicker.m</p>
<p>We find the func : </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">imageCropViewController:(RSKImageCropViewController *)controller</span><br><span class="line">                   didCropImage:(UIImage *)croppedImage</span><br><span class="line">                  usingCropRect:(CGRect)cropRect</span><br></pre></td></tr></table></figure>
<p>and we will change code to delete compressImage void and then the picture will not be compressed, or you can compressed your code by yourself to write OC code.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">CGSize desiredImageSize = CGSizeMake([[[self options] objectForKey:@&quot;width&quot;] intValue],</span><br><span class="line">                                         [[[self options] objectForKey:@&quot;height&quot;] intValue]);</span><br><span class="line">UIImage *resizedImage = [croppedImage resizedImageToFitInSize:desiredImageSize scaleIfSmaller:YES];</span><br><span class="line">+ ImageResult *imageResult = [self.compression compressImage:croppedImage withOptions:self.options];</span><br><span class="line">-  ImageResult *imageResult = [self.compression compressImage:resizedImage withOptions:self.options];</span><br></pre></td></tr></table></figure>
<p>I change the iOS Library. it is the whole function changed:</p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)imageCropViewController:(RSKImageCropViewController *)controller</span><br><span class="line">                   didCropImage:(<span class="built_in">UIImage</span> *)croppedImage</span><br><span class="line">                  usingCropRect:(<span class="built_in">CGRect</span>)cropRect &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// we have correct rect, but not correct dimensions</span></span><br><span class="line">    <span class="comment">// so resize image</span></span><br><span class="line">    <span class="built_in">CGSize</span> desiredImageSize = <span class="built_in">CGSizeMake</span>([[[<span class="keyword">self</span> options] objectForKey:<span class="string">@"width"</span>] intValue],</span><br><span class="line">                                         [[[<span class="keyword">self</span> options] objectForKey:<span class="string">@"height"</span>] intValue]);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">UIImage</span> *resizedImage = [croppedImage resizedImageToFitInSize:desiredImageSize scaleIfSmaller:<span class="literal">YES</span>];</span><br><span class="line">    ImageResult *imageResult = [<span class="keyword">self</span>.compression compressImage:croppedImage withOptions:<span class="keyword">self</span>.options];</span><br><span class="line"></span><br><span class="line">    <span class="built_in">NSString</span> *filePath = [<span class="keyword">self</span> persistFile:imageResult.data];</span><br><span class="line">    <span class="keyword">if</span> (filePath == <span class="literal">nil</span>) &#123;</span><br><span class="line">        [<span class="keyword">self</span> dismissCropper:controller selectionDone:<span class="literal">YES</span> completion:[<span class="keyword">self</span> waitAnimationEnd:^&#123;</span><br><span class="line">            <span class="keyword">self</span>.reject(ERROR_CANNOT_SAVE_IMAGE_KEY, ERROR_CANNOT_SAVE_IMAGE_MSG, <span class="literal">nil</span>);</span><br><span class="line">        &#125;]];</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">NSDictionary</span>* exif = <span class="literal">nil</span>;</span><br><span class="line">    <span class="keyword">if</span>([[<span class="keyword">self</span>.options objectForKey:<span class="string">@"includeExif"</span>] boolValue]) &#123;</span><br><span class="line">        exif = [[<span class="built_in">CIImage</span> imageWithData:imageResult.data] properties];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [<span class="keyword">self</span> dismissCropper:controller selectionDone:<span class="literal">YES</span> completion:[<span class="keyword">self</span> waitAnimationEnd:^&#123;</span><br><span class="line">        <span class="keyword">self</span>.resolve([<span class="keyword">self</span> createAttachmentResponse:filePath</span><br><span class="line">                                           withExif: exif</span><br><span class="line">                                      withSourceURL: <span class="keyword">self</span>.croppingFile[<span class="string">@"sourceURL"</span>]</span><br><span class="line">                                withLocalIdentifier: <span class="keyword">self</span>.croppingFile[<span class="string">@"localIdentifier"</span>]</span><br><span class="line">                                       withFilename: <span class="keyword">self</span>.croppingFile[<span class="string">@"filename"</span>]</span><br><span class="line">                                          withWidth:imageResult.width</span><br><span class="line">                                         withHeight:imageResult.height</span><br><span class="line">                                           withMime:imageResult.mime</span><br><span class="line">                                           withSize:[<span class="built_in">NSNumber</span> numberWithUnsignedInteger:imageResult.data.length]</span><br><span class="line">                                           withData:[[<span class="keyword">self</span>.options objectForKey:<span class="string">@"includeBase64"</span>] boolValue] ? [imageResult.data base64EncodedStringWithOptions:<span class="number">0</span>] : <span class="literal">nil</span></span><br><span class="line">                                           withRect:cropRect</span><br><span class="line">                                   withCreationDate:<span class="keyword">self</span>.croppingFile[<span class="string">@"creationDate"</span>]</span><br><span class="line">                               withModificationDate:<span class="keyword">self</span>.croppingFile[<span class="string">@"modificationDate"</span>]</span><br><span class="line">                      ]);</span><br><span class="line">    &#125;]];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>And then, you will keep the width and height: 300 / 400 at iOS Platform, it will work well. Now you have solved this question. You can write just like this.</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (Platform.OS === <span class="string">'ios'</span>) &#123;</span><br><span class="line">    ImagePicker.openPicker(&#123;</span><br><span class="line">      width: <span class="number">300</span>,</span><br><span class="line">      height: <span class="number">400</span>,</span><br><span class="line">      compressImageQuality: <span class="number">1.0</span>,</span><br><span class="line">      cropping: <span class="literal">true</span></span><br><span class="line">    &#125;).then(<span class="function"><span class="params">image</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.props.navigation.push(<span class="string">'LooksUploadImagePage'</span>, &#123;</span><br><span class="line">        imageUrl: image.path,</span><br><span class="line">        returnPage: <span class="string">'Tabs'</span>,</span><br><span class="line">        takePhoto: <span class="keyword">this</span>.takePhoto,</span><br><span class="line">        isCamera: <span class="literal">false</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    ImagePicker.openPicker(&#123;</span><br><span class="line">      width: <span class="number">1200</span>,</span><br><span class="line">      height: <span class="number">1600</span>,</span><br><span class="line">      compressImageQuality: <span class="number">1.0</span>,</span><br><span class="line">      cropping: <span class="literal">true</span></span><br><span class="line">    &#125;).then(<span class="function"><span class="params">image</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.props.navigation.push(<span class="string">'LooksUploadImagePage'</span>, &#123;</span><br><span class="line">        imageUrl: image.path,</span><br><span class="line">        returnPage: <span class="string">'Tabs'</span>,</span><br><span class="line">        takePhoto: <span class="keyword">this</span>.takePhoto,</span><br><span class="line">        isCamera: <span class="literal">false</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://leviduan.com/2020/01/08/2020-01-08-11/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Levi Duan">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Levi's blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/08/2020-01-08-11/" itemprop="url">React native - contentContainerStyle (Flatlist)</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-01-08T22:53:02+08:00">
                2020-01-08
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web/" itemprop="url" rel="index">
                    <span itemprop="name">web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/01/08/2020-01-08-11/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020/01/08/2020-01-08-11/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>contentContainerStyle </p>
<p>Flatlist <code>style</code> defines the outer container of the Flatlist, e.g its height and relations to siblings elements</p>
<p>Flatlist <code>contentContainerStyle</code> defines the inner container of it, e.g items alignments, padding, etc</p>
<p>Just like this :</p>
<p><img src="https://i.stack.imgur.com/CDm8y.png" alt="img"></p>
<p>You can use <code>marginHorizontal: 10</code> to hold the offset between two picture in renderItem. but you can’t get the offset between picture and left edge. So the best solution is contentContainerStyle can be set this offset to resolve the question.</p>
<p><img src="/images/15784951633891.png" alt></p>
<p>Show my code:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">avatarListFlatList = props =&gt; &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;View style=&#123;&#123;width: ScreenUtil.screenW, height: 106, marginTop: 17&#125;&#125;&gt;</span><br><span class="line">        &lt;FlatList</span><br><span class="line">          showsHorizontalScrollIndicator=&#123;false&#125;</span><br><span class="line">          showsVerticalScrollIndicator=&#123;false&#125;</span><br><span class="line">          data=&#123;props&#125;</span><br><span class="line">          contentContainerStyle=&#123;&#123;paddingLeft: 10, paddingRight: 10&#125;&#125;</span><br><span class="line">          keyExtractor=&#123;(item, index) =&gt; index.toString()&#125;</span><br><span class="line">          renderItem=&#123;(&#123;item&#125;) =&gt; this.avatarListFlatListItem(item)&#125;</span><br><span class="line">          horizontal=&#123;true&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">      &lt;/View&gt;</span><br><span class="line">    );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">avatarListFlatListItem = props =&gt; &#123;</span><br><span class="line">    let randomColor = () =&gt; &#123;</span><br><span class="line">      var r = Math.floor(Math.random() * 256);</span><br><span class="line">      var g = Math.floor(Math.random() * 256);</span><br><span class="line">      var b = Math.floor(Math.random() * 256);</span><br><span class="line">      return `rgba($&#123;r&#125;,$&#123;g&#125;,$&#123;b&#125;,0.5)`;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    const colorStyles = &#123;</span><br><span class="line">      backgroundColor: randomColor(),</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    return (</span><br><span class="line">      &lt;View style=&#123;&#123;height: 106, marginVertical: 0, marginHorizontal: 10&#125;&#125;&gt;</span><br><span class="line">        &lt;TouchableOpacity</span><br><span class="line">          activeOpacity=&#123;1.0&#125;</span><br><span class="line">          onPress=&#123;() =&gt;</span><br><span class="line">            this.props.navigation.push(&apos;LookbookStarPage&apos;, &#123;</span><br><span class="line">              data: props.influencer_id,</span><br><span class="line">              returnPage: &apos;Tabs&apos;,</span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;&gt;</span><br><span class="line">          &lt;Image</span><br><span class="line">            source=&#123;&#123;uri: props.avatar_local_path&#125;&#125;</span><br><span class="line">            style=&#123;[</span><br><span class="line">              &#123;</span><br><span class="line">                width: 80,</span><br><span class="line">                height: 80,</span><br><span class="line">                borderRadius: 40,</span><br><span class="line">              &#125;,</span><br><span class="line">              colorStyles,</span><br><span class="line">            ]&#125;&gt;&lt;/Image&gt;</span><br><span class="line"></span><br><span class="line">          &lt;Text</span><br><span class="line">            numberOfLines=&#123;1&#125;</span><br><span class="line">            style=&#123;&#123;</span><br><span class="line">              fontSize: 16,</span><br><span class="line">              width: 80,</span><br><span class="line">              fontFamily: &apos;HelveticaNeue&apos;,</span><br><span class="line">              color: &apos;#000000&apos;,</span><br><span class="line">              marginTop: 8,</span><br><span class="line">              textAlign: &apos;center&apos;,</span><br><span class="line">            &#125;&#125;&gt;</span><br><span class="line">            &#123;props.display_name&#125;</span><br><span class="line">          &lt;/Text&gt;</span><br><span class="line">        &lt;/TouchableOpacity&gt;</span><br><span class="line">      &lt;/View&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://leviduan.com/2020/01/08/2020-01-08-10/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Levi Duan">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Levi's blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/08/2020-01-08-10/" itemprop="url">React native - react-native-share</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-01-08T22:51:02+08:00">
                2020-01-08
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web/" itemprop="url" rel="index">
                    <span itemprop="name">web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/01/08/2020-01-08-10/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020/01/08/2020-01-08-10/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>When we use share function, the best library is react-native-share. React Native Share, a simple tool for share message and file to other apps.</p>
<p>Git website: <a href="https://github.com/react-native-community/react-native-share/" target="_blank" rel="noopener">https://github.com/react-native-community/react-native-share/</a></p>
<h3 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install react-native-share --save</span><br><span class="line"></span><br><span class="line">react-native link react-native-share</span><br><span class="line"></span><br><span class="line">cd ios &amp;&amp; pod install &amp;&amp; cd ../</span><br></pre></td></tr></table></figure>
<h3 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Share <span class="keyword">from</span> <span class="string">'react-native-share'</span>;</span><br><span class="line"></span><br><span class="line">Share.open(options)</span><br><span class="line">.then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123; <span class="built_in">console</span>.log(res) &#125;)</span><br><span class="line">.catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123; err &amp;&amp; <span class="built_in">console</span>.log(err); &#125;);</span><br><span class="line"></span><br><span class="line">Share.open(&#123;<span class="attr">url</span> : ScreenUtil.webUrl + <span class="string">'/streetsnapShareToPhoto?id='</span> + <span class="keyword">this</span>.state.data.id, <span class="attr">message</span>: <span class="string">"Deja"</span>&#125;)</span><br><span class="line">.then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123; <span class="built_in">console</span>.warn(res) &#125;)</span><br><span class="line">.catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123; err &amp;&amp; <span class="built_in">console</span>.warn(err); &#125;);</span><br></pre></td></tr></table></figure>
<p>Supported options:</p>
<table>
<thead>
<tr>
<th style="text-align:left">Name</th>
<th style="text-align:center">Type</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">url</td>
<td style="text-align:center">string</td>
<td style="text-align:left">URL you want to share (only support base64 string in iOS &amp; Android).</td>
</tr>
<tr>
<td style="text-align:left">urls</td>
<td style="text-align:center">Array[string]</td>
<td style="text-align:left">array of base64 string you want to share (only support iOS &amp; Android).</td>
</tr>
<tr>
<td style="text-align:left">type</td>
<td style="text-align:center">string</td>
<td style="text-align:left">File mime type (optional)</td>
</tr>
<tr>
<td style="text-align:left">message</td>
<td style="text-align:center">string</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">title</td>
<td style="text-align:center">string</td>
<td style="text-align:left">(optional)</td>
</tr>
<tr>
<td style="text-align:left">subject</td>
<td style="text-align:center">string</td>
<td style="text-align:left">(optional)</td>
</tr>
<tr>
<td style="text-align:left">email</td>
<td style="text-align:center">string</td>
<td style="text-align:left">Email of addressee (optional)</td>
</tr>
<tr>
<td style="text-align:left">excludedActivityTypes</td>
<td style="text-align:center">string</td>
<td style="text-align:left">(optional)</td>
</tr>
<tr>
<td style="text-align:left">failOnCancel</td>
<td style="text-align:center">boolean</td>
<td style="text-align:left">(defaults to true) Specifies whether promise should reject if user cancels share dialog (optional)</td>
</tr>
<tr>
<td style="text-align:left">showAppsToView</td>
<td style="text-align:center">boolean</td>
<td style="text-align:left">(optional) only android</td>
</tr>
<tr>
<td style="text-align:left">filename</td>
<td style="text-align:center">string</td>
<td style="text-align:left">only support base64 string in Android</td>
</tr>
</tbody>
</table>
<p>These can be assessed using Share.Social property For eg.</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Share <span class="keyword">from</span> <span class="string">'react-native-share'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> shareOptions = &#123;</span><br><span class="line">    title: <span class="string">'Share via'</span>,</span><br><span class="line">    message: <span class="string">'some message'</span>,</span><br><span class="line">    url: <span class="string">'some share url'</span>,</span><br><span class="line">    social: Share.Social.WHATSAPP,</span><br><span class="line">    whatsAppNumber: <span class="string">"9199999999"</span>  <span class="comment">// country code + phone number(currently only works on Android)</span></span><br><span class="line">    filename: <span class="string">'test'</span> , <span class="comment">// only for base64 file in Android </span></span><br><span class="line">&#125;;</span><br><span class="line">Share.shareSingle(shareOptions);</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th style="text-align:left">Name</th>
<th style="text-align:center">Android</th>
<th style="text-align:left">iOS</th>
<th style="text-align:left">Windows</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>FACEBOOK</strong></td>
<td style="text-align:center">yes</td>
<td style="text-align:left">yes</td>
<td style="text-align:left">no</td>
</tr>
<tr>
<td style="text-align:left"><strong>PAGESMANAGER</strong></td>
<td style="text-align:center">yes</td>
<td style="text-align:left">no</td>
<td style="text-align:left">no</td>
</tr>
<tr>
<td style="text-align:left"><strong>WHATSAPP</strong></td>
<td style="text-align:center">yes</td>
<td style="text-align:left">yes</td>
<td style="text-align:left">no</td>
</tr>
<tr>
<td style="text-align:left"><strong>INSTAGRAM</strong></td>
<td style="text-align:center">yes</td>
<td style="text-align:left">yes</td>
<td style="text-align:left">no</td>
</tr>
<tr>
<td style="text-align:left"><strong>GOOGLEPLUS</strong></td>
<td style="text-align:center">yes</td>
<td style="text-align:left">yes</td>
<td style="text-align:left">no</td>
</tr>
<tr>
<td style="text-align:left"><strong>EMAIL</strong></td>
<td style="text-align:center">yes</td>
<td style="text-align:left">yes</td>
<td style="text-align:left">no</td>
</tr>
<tr>
<td style="text-align:left"><strong>PINTEREST</strong></td>
<td style="text-align:center">yes</td>
<td style="text-align:left">no</td>
<td style="text-align:left">no</td>
</tr>
<tr>
<td style="text-align:left"><strong>SMS</strong></td>
<td style="text-align:center">yes</td>
<td style="text-align:left">no</td>
<td style="text-align:left">no</td>
</tr>
<tr>
<td style="text-align:left"><strong>SNAPCHAT</strong></td>
<td style="text-align:center">yes</td>
<td style="text-align:left">no</td>
<td style="text-align:left">no</td>
</tr>
<tr>
<td style="text-align:left"><strong>MESSENGER</strong></td>
<td style="text-align:center">yes</td>
<td style="text-align:left">no</td>
<td style="text-align:left">no</td>
</tr>
<tr>
<td style="text-align:left"><strong>LINKEDIN</strong></td>
<td style="text-align:center">yes</td>
<td style="text-align:left">no</td>
<td style="text-align:left">no</td>
</tr>
</tbody>
</table>
<h4 id="React-native-share-library-question-Currently-on-iOS-13-the-app-will-crash"><a href="#React-native-share-library-question-Currently-on-iOS-13-the-app-will-crash" class="headerlink" title="React native share library question - Currently on iOS 13 the app will crash"></a>React native share library question - Currently on iOS 13 the app will crash</h4><p>Currently on iOS 13 the app will crash if you:</p>
<ul>
<li>Open the share sheet</li>
<li>Tap something like messages or photos</li>
<li>Cancel the dialog</li>
<li>Perform any other action</li>
</ul>
<p>This is because shareController.completionWithItemsHandler is called when the dialog box is canceled and currently failureCallback or successCallback will always be called. In the situation above, activityError is nil so successCallback will be called even though completed is false. This leaves us in a state where the callback has been invoked but the ShareSheet is still active, meaning the success or error callback will be invoked again, leading to the crash.</p>
<p>This PR adds a check to make sure completed is true before calling successCallback. This way successCallback will only be called when the user has successfully completed an action and the ShareSheet is closed.</p>
<p>Only call successCallback when completed is true (iOS 13 crash)</p>
<figure class="highlight objectivec"><table><tr><td class="code"><pre><span class="line">shareController.completionWithItemsHandler = ^(<span class="built_in">NSString</span> *activityType, <span class="built_in">BOOL</span> completed, __unused <span class="built_in">NSArray</span> *returnedItems, <span class="built_in">NSError</span> *activityError) &#123;</span><br><span class="line">    <span class="keyword">if</span> (activityError) &#123;</span><br><span class="line">        failureCallback(activityError);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (completed) &#123;</span><br><span class="line">        successCallback(@[@(completed), RCTNullIfNil(activityType)]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://leviduan.com/2020/01/08/2020-01-08-9/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Levi Duan">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Levi's blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/08/2020-01-08-9/" itemprop="url">React native - DeviceEventEmitter API</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-01-08T22:50:02+08:00">
                2020-01-08
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web/" itemprop="url" rel="index">
                    <span itemprop="name">web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/01/08/2020-01-08-9/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020/01/08/2020-01-08-9/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>We usually use Notification in iOS just like this:</p>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="type">NotificationCenter</span>.<span class="keyword">default</span>.addObserver(<span class="keyword">self</span>, selector: #selector(forYouRecommendUpdate), name: <span class="type">Notification</span>.<span class="type">Name</span>(rawValue: kDJForYouVCReloadAll), object: <span class="literal">nil</span>)</span><br><span class="line"></span><br><span class="line"><span class="type">NotificationCenter</span>.<span class="keyword">default</span>.post(name: <span class="type">Notification</span>.<span class="type">Name</span>(rawValue: kDJForYouVCReloadAll), object: <span class="literal">nil</span>)</span><br></pre></td></tr></table></figure>
<p>However, how to use a Notification in React native? The best way that we achieve it by <code>DeviceEventEmitter</code></p>
<h3 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h3><p>Page A to register a Notification</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span>  &#123;DeviceEventEmitter&#125; <span class="keyword">from</span> <span class="string">'react-native'</span>;</span><br><span class="line"></span><br><span class="line">DeviceEventEmitter.emit(<span class="string">'xxxName’,param);</span></span><br></pre></td></tr></table></figure>
<p>Page B to post a Notification</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">componentDidMount()&#123;</span><br><span class="line">    <span class="keyword">this</span>.listener =DeviceEventEmitter.addListener(<span class="string">'xxxName'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">param</span>)</span>&#123;</span><br><span class="line">    <span class="comment">//  use param do something</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">componentWillUnmount()&#123;</span><br><span class="line">  <span class="keyword">this</span>.listener.remove();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// we need to remove the listener by componentWillUnmount</span></span><br></pre></td></tr></table></figure>
<p>This simple version</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 注册事件通知</span></span><br><span class="line"><span class="keyword">let</span> param = <span class="string">'test'</span></span><br><span class="line">DeviceEventEmitter.emit(<span class="string">'testName'</span>,param);</span><br><span class="line">DeviceEventEmitter.emit(<span class="string">'event.test'</span>, &#123;&#125;);</span><br><span class="line"><span class="comment">//testName:通知的名称 param：发送的消息（传参）</span></span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://leviduan.com/2020/01/08/2020-01-08-8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Levi Duan">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Levi's blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/08/2020-01-08-8/" itemprop="url">React native - My ScreenUtil Library</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-01-08T22:50:01+08:00">
                2020-01-08
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web/" itemprop="url" rel="index">
                    <span itemprop="name">web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/01/08/2020-01-08-8/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020/01/08/2020-01-08-8/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><code>ScreenUtil.js</code> is my tool JS file, you can use it simple. just like:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> ScreenUtil <span class="keyword">from</span> <span class="string">'../../ScreenUtil'</span>;</span><br><span class="line"></span><br><span class="line">style=&#123;&#123;</span><br><span class="line">  width: ScreenUtil.screenW,</span><br><span class="line">  height: ((ScreenUtil.screenW - <span class="number">42</span>) / <span class="number">2.0</span> / <span class="number">3.0</span>) * <span class="number">4.0</span>,</span><br><span class="line">  borderRadius: <span class="number">5</span>,</span><br><span class="line">  overflow: <span class="string">'hidden'</span>,</span><br><span class="line">&#125;&#125;&gt;</span><br></pre></td></tr></table></figure>
<p>You can use this file by copying this code.</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 屏幕工具类 以及一些常用的工具类封装</span></span><br><span class="line"><span class="comment"> * ui设计基准,iphone 6 2倍图</span></span><br><span class="line"><span class="comment"> * width:750px</span></span><br><span class="line"><span class="comment"> * height:1334px</span></span><br><span class="line"><span class="comment"> * @2x</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  PixelRatio,</span><br><span class="line">  Dimensions,</span><br><span class="line">  Platform,</span><br><span class="line">  AsyncStorage</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'react-native'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> screenW = Dimensions.get(<span class="string">'window'</span>).width;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> screenH = Dimensions.get(<span class="string">'window'</span>).height;</span><br><span class="line"><span class="keyword">const</span> fontScale = PixelRatio.getFontScale();</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> pixelRatio = PixelRatio.get();</span><br><span class="line"><span class="comment">//像素密度</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> DEFAULT_DENSITY = <span class="number">2</span>;</span><br><span class="line"><span class="comment">//px转换成dp</span></span><br><span class="line"><span class="comment">//以iphone6为基准,如果以其他尺寸为基准的话,请修改下面的defaultWidth和defaultHeight为对应尺寸即可. 以下为1倍图时</span></span><br><span class="line"><span class="keyword">const</span> defaultWidth = <span class="number">375</span>;</span><br><span class="line"><span class="keyword">const</span> defaultHeight = <span class="number">667</span>;</span><br><span class="line"><span class="keyword">const</span> w2 = defaultWidth / DEFAULT_DENSITY;</span><br><span class="line"><span class="comment">//px转换成dp</span></span><br><span class="line"><span class="keyword">const</span> h2 = defaultHeight / DEFAULT_DENSITY;</span><br><span class="line"></span><br><span class="line"><span class="comment">//缩放比例</span></span><br><span class="line"><span class="keyword">const</span> _scaleWidth = screenW / defaultWidth;</span><br><span class="line"><span class="keyword">const</span> _scaleHeight = screenH / defaultHeight;</span><br><span class="line"></span><br><span class="line"><span class="comment">// iPhoneX</span></span><br><span class="line"><span class="keyword">const</span> X_WIDTH = <span class="number">375</span>;</span><br><span class="line"><span class="keyword">const</span> X_HEIGHT = <span class="number">812</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> web_DT = <span class="string">'https://dt.xx.co/'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> web_DP = <span class="string">'https://dp.xx.co'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> web_PR = <span class="string">'https://xx.co'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> webUrl = web_PR</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 屏幕适配,缩放size , 默认根据宽度适配，纵向也可以使用此方法</span></span><br><span class="line"><span class="comment">* 横向的尺寸直接使用此方法</span></span><br><span class="line"><span class="comment">* 如：width ,paddingHorizontal ,paddingLeft ,paddingRight ,marginHorizontal ,marginLeft ,marginRight</span></span><br><span class="line"><span class="comment">* @param size 设计图的尺寸</span></span><br><span class="line"><span class="comment">* @returns &#123;number&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">scaleSize</span>(<span class="params">size: Number</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> size * _scaleWidth;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 屏幕适配 , 纵向的尺寸使用此方法应该会更趋近于设计稿</span></span><br><span class="line"><span class="comment">* 如：height ,paddingVertical ,paddingTop ,paddingBottom ,marginVertical ,marginTop ,marginBottom</span></span><br><span class="line"><span class="comment">* @param size 设计图的尺寸</span></span><br><span class="line"><span class="comment">* @returns &#123;number&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">scaleHeight</span>(<span class="params">size: Number</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> size * _scaleHeight;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 最初版本尺寸适配方案 也许你会更喜欢这个</span></span><br><span class="line"><span class="comment">export function scaleSize(size: Number) &#123;</span></span><br><span class="line"><span class="comment">  let scaleWidth = screenW / w2;</span></span><br><span class="line"><span class="comment">  let scaleHeight = screenH / h2;</span></span><br><span class="line"><span class="comment">  let scale = Math.min(scaleWidth, scaleHeight);</span></span><br><span class="line"><span class="comment">  size = Math.round((size * scale + 0.5));</span></span><br><span class="line"><span class="comment">  return size / DEFAULT_DENSITY;</span></span><br><span class="line"><span class="comment">&#125;*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 设置字体的size（单位px）</span></span><br><span class="line"><span class="comment">* @param size 传入设计稿上的px , allowFontScaling 是否根据设备文字缩放比例调整，默认不会</span></span><br><span class="line"><span class="comment">* @returns &#123;Number&#125; 返回实际sp</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setSpText</span>(<span class="params">size: Number, allowFontScaling = false</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> scale = <span class="built_in">Math</span>.min(_scaleWidth, _scaleHeight);</span><br><span class="line">  <span class="keyword">const</span> fontSize = allowFontScaling ? <span class="number">1</span> : fontScale;</span><br><span class="line">  <span class="keyword">return</span> size * scale / fontSize;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">setSpText2</span>(<span class="params">size: Number</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> scaleWidth = screenW / w2;</span><br><span class="line">  <span class="keyword">let</span> scaleHeight = screenH / h2;</span><br><span class="line">  <span class="keyword">let</span> scale = <span class="built_in">Math</span>.min(scaleWidth, scaleHeight);</span><br><span class="line">  size = <span class="built_in">Math</span>.round((size * scale + <span class="number">0.5</span>));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> size / DEFAULT_DENSITY * fontScale;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 判断是否为iphoneX</span></span><br><span class="line"><span class="comment">* @returns &#123;boolean&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">isIphoneX</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">      Platform.OS === <span class="string">'ios'</span> &amp;&amp;</span><br><span class="line">      ((screenH === X_HEIGHT &amp;&amp; screenW === X_WIDTH) ||</span><br><span class="line">          (screenH === X_WIDTH &amp;&amp; screenW === X_HEIGHT))</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 根据是否是iPhoneX返回不同的样式</span></span><br><span class="line"><span class="comment">* @param iphoneXStyle</span></span><br><span class="line"><span class="comment">* @param iosStyle</span></span><br><span class="line"><span class="comment">* @param androidStyle</span></span><br><span class="line"><span class="comment">* @returns &#123;*&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">ifIphoneX</span>(<span class="params">iphoneXStyle, iosStyle = &#123;&#125;, androidStyle</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (isIphoneX()) &#123;</span><br><span class="line">      <span class="keyword">return</span> iphoneXStyle;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (Platform.OS === <span class="string">'ios'</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> iosStyle</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (androidStyle) <span class="keyword">return</span> androidStyle;</span><br><span class="line">      <span class="keyword">return</span> iosStyle</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 判断对象，数组，字符串是否为空</span></span><br><span class="line"><span class="comment">* @param str  (null|undefined|''|'   '|[]|&#123;&#125;) 均判断为空，返回true</span></span><br><span class="line"><span class="comment">* @returns &#123;boolean&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">isEmpty</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!str) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> str === <span class="string">'object'</span> &amp;&amp; <span class="built_in">Object</span>.keys(str).length === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (str.replace(<span class="regexp">/(^\s*)|(\s*$)/g</span>, <span class="string">""</span>).length === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//时间处理</span></span><br><span class="line"><span class="built_in">Date</span>.prototype.format = <span class="function"><span class="keyword">function</span> (<span class="params">format</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> date = &#123;</span><br><span class="line">      <span class="string">"M+"</span>: <span class="keyword">this</span>.getMonth() + <span class="number">1</span>,</span><br><span class="line">      <span class="string">"d+"</span>: <span class="keyword">this</span>.getDate(),</span><br><span class="line">      <span class="string">"h+"</span>: <span class="keyword">this</span>.getHours(),</span><br><span class="line">      <span class="string">"m+"</span>: <span class="keyword">this</span>.getMinutes(),</span><br><span class="line">      <span class="string">"s+"</span>: <span class="keyword">this</span>.getSeconds(),</span><br><span class="line">      <span class="string">"q+"</span>: <span class="built_in">Math</span>.floor((<span class="keyword">this</span>.getMonth() + <span class="number">3</span>) / <span class="number">3</span>),</span><br><span class="line">      <span class="string">"S+"</span>: <span class="keyword">this</span>.getMilliseconds()</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">if</span> (<span class="regexp">/(y+)/i</span>.test(format)) &#123;</span><br><span class="line">      format = format.replace(<span class="built_in">RegExp</span>.$<span class="number">1</span>, (<span class="keyword">this</span>.getFullYear() + <span class="string">''</span>).substr(<span class="number">4</span> - <span class="built_in">RegExp</span>.$<span class="number">1.</span>length));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> k <span class="keyword">in</span> date) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">"("</span> + k + <span class="string">")"</span>).test(format)) &#123;</span><br><span class="line">          format = format.replace(<span class="built_in">RegExp</span>.$<span class="number">1</span>, <span class="built_in">RegExp</span>.$<span class="number">1.</span>length === <span class="number">1</span></span><br><span class="line">              ? date[k] : (<span class="string">"00"</span> + date[k]).substr((<span class="string">""</span> + date[k]).length));</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> format;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取时间差 current:1497235409744 当前时间  start:1497235419744 开始时间</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getRemainingime</span>(<span class="params">current: Number, start: Number</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> time = start - current;</span><br><span class="line">  <span class="keyword">if</span> (time &lt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> [<span class="string">"0"</span>, <span class="string">"0"</span>, <span class="string">"0"</span>, <span class="string">"0"</span>, <span class="string">"0"</span>, <span class="string">"0"</span>];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> year = <span class="built_in">Math</span>.floor(time / (<span class="number">365</span> * <span class="number">30</span> * <span class="number">24</span> * <span class="number">3600</span> * <span class="number">1000</span>));<span class="comment">//年</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> month = <span class="built_in">Math</span>.floor(time / (<span class="number">30</span> * <span class="number">24</span> * <span class="number">3600</span> * <span class="number">1000</span>));<span class="comment">//月</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> days = <span class="built_in">Math</span>.floor(time / (<span class="number">24</span> * <span class="number">3600</span> * <span class="number">1000</span>));<span class="comment">//日</span></span><br><span class="line">  <span class="keyword">let</span> temp1 = time % (<span class="number">24</span> * <span class="number">3600</span> * <span class="number">1000</span>);</span><br><span class="line">  <span class="keyword">let</span> temp2 = temp1 % (<span class="number">3600</span> * <span class="number">1000</span>);</span><br><span class="line">  <span class="keyword">let</span> minutes = <span class="built_in">Math</span>.floor(temp2 / (<span class="number">60</span> * <span class="number">1000</span>));<span class="comment">//分</span></span><br><span class="line">  <span class="keyword">let</span> hours = <span class="built_in">Math</span>.floor(temp1 / (<span class="number">3600</span> * <span class="number">1000</span>));<span class="comment">//时</span></span><br><span class="line">  <span class="keyword">let</span> temp3 = temp2 % (<span class="number">60</span> * <span class="number">1000</span>);</span><br><span class="line">  <span class="keyword">let</span> seconds = <span class="built_in">Math</span>.round(temp3 / <span class="number">1000</span>);<span class="comment">//秒</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> strs = [year, toNormal(month), toNormal(days), toNormal(hours), toNormal(minutes), toNormal(seconds)];</span><br><span class="line">  <span class="keyword">return</span> strs;<span class="comment">//["0", "0", "2", "7", "33", "30"]0年0月2日 7时33分30秒</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//1497235419</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getRemainingimeDistance</span>(<span class="params">distance: Number</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> time = distance * <span class="number">1000</span>;</span><br><span class="line">  <span class="keyword">if</span> (time &lt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> [<span class="string">"0"</span>, <span class="string">"0"</span>, <span class="string">"0"</span>, <span class="string">"0"</span>, <span class="string">"0"</span>, <span class="string">"0"</span>];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> year = <span class="built_in">Math</span>.floor(time / (<span class="number">365</span> * <span class="number">30</span> * <span class="number">24</span> * <span class="number">3600</span> * <span class="number">1000</span>));<span class="comment">//年</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> month = <span class="built_in">Math</span>.floor(time / (<span class="number">30</span> * <span class="number">24</span> * <span class="number">3600</span> * <span class="number">1000</span>));<span class="comment">//月</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> days = <span class="built_in">Math</span>.floor(time / (<span class="number">24</span> * <span class="number">3600</span> * <span class="number">1000</span>));<span class="comment">//日</span></span><br><span class="line">  <span class="keyword">let</span> temp1 = time % (<span class="number">24</span> * <span class="number">3600</span> * <span class="number">1000</span>);</span><br><span class="line">  <span class="keyword">let</span> hours = <span class="built_in">Math</span>.floor(temp1 / (<span class="number">3600</span> * <span class="number">1000</span>));<span class="comment">//时</span></span><br><span class="line">  <span class="keyword">let</span> temp2 = temp1 % (<span class="number">3600</span> * <span class="number">1000</span>);</span><br><span class="line">  <span class="keyword">let</span> minutes = <span class="built_in">Math</span>.floor(temp2 / (<span class="number">60</span> * <span class="number">1000</span>));<span class="comment">//分</span></span><br><span class="line">  <span class="keyword">let</span> temp3 = temp2 % (<span class="number">60</span> * <span class="number">1000</span>);</span><br><span class="line">  <span class="keyword">let</span> seconds = <span class="built_in">Math</span>.round(temp3 / <span class="number">1000</span>);<span class="comment">//秒</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> strs = [year, toNormal(month), toNormal(days), toNormal(hours), toNormal(minutes), toNormal(seconds)];</span><br><span class="line">  <span class="comment">// strs.splice(0, 1, String(Number(strs[0]) - 1970));//年</span></span><br><span class="line">  <span class="comment">// strs.splice(1, 1, String(Number(strs[1]) - 1));</span></span><br><span class="line">  <span class="comment">// strs.splice(2, 1, (Number(strs[2]) - 1) &lt; 10 ? '0' + (Number(strs[2]) - 1) : String(Number(strs[2]) - 1));</span></span><br><span class="line">  <span class="comment">// strs.splice(3, 1, (Number(strs[3]) - 8) &lt; 10 ? '0' + (Number(strs[3]) - 8) : String(Number(strs[3]) - 8));</span></span><br><span class="line">  <span class="comment">// strs.splice(4, 1, Number(strs[4]) &lt; 10 ? '0' + Number(strs[4]) : String(Number(strs[4])));</span></span><br><span class="line">  <span class="comment">// strs.splice(5, 1, Number(strs[5]) &lt; 10 ? '0' + Number(strs[5]) : String(Number(strs[5])));</span></span><br><span class="line">  <span class="keyword">return</span> strs;<span class="comment">//["0", "0", "2", "7", "33", "30"]0年0月2日 7时33分30秒</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">toNormal</span>(<span class="params">time: Number</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> time &gt;= <span class="number">10</span> ? time : <span class="string">'0'</span> + time;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//转换成日期</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">toDate</span>(<span class="params">timestamp: Number, format1 = <span class="string">'yyyy-MM-dd hh:mm:ss'</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (timestamp &gt; <span class="number">10000</span>) &#123;</span><br><span class="line">          <span class="keyword">let</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">          date.setTime(timestamp);</span><br><span class="line">          <span class="keyword">return</span> date.format(format1);<span class="comment">//2014-07-10 10:21:12</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="string">''</span>;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (erro) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">''</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">''</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//转换成时间搓</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">toTimestamp</span>(<span class="params">date: String</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> timestamp = <span class="built_in">Date</span>.parse(date);</span><br><span class="line">  <span class="keyword">return</span> timestamp / <span class="number">1000</span>;  <span class="comment">// 1497233827569/1000</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//CST时间=&gt;转换成日期yyyy-MM-dd hh:mm:ss</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getTaskTime</span>(<span class="params">strDate</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="literal">null</span> == strDate || <span class="string">""</span> == strDate) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> dateStr = strDate.trim().split(<span class="string">" "</span>);</span><br><span class="line">  <span class="keyword">let</span> strGMT = dateStr[<span class="number">0</span>] + <span class="string">" "</span> + dateStr[<span class="number">1</span>] + <span class="string">" "</span> + dateStr[<span class="number">2</span>] + <span class="string">" "</span> + dateStr[<span class="number">5</span>] + <span class="string">" "</span> + dateStr[<span class="number">3</span>] + <span class="string">" GMT+0800"</span>;</span><br><span class="line">  <span class="keyword">let</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="built_in">Date</span>.parse(strGMT));</span><br><span class="line">  <span class="keyword">let</span> y = date.getFullYear();</span><br><span class="line">  <span class="keyword">let</span> m = date.getMonth() + <span class="number">1</span>;</span><br><span class="line">  m = m &lt; <span class="number">10</span> ? (<span class="string">'0'</span> + m) : m;</span><br><span class="line">  <span class="keyword">let</span> d = date.getDate();</span><br><span class="line">  d = d &lt; <span class="number">10</span> ? (<span class="string">'0'</span> + d) : d;</span><br><span class="line">  <span class="keyword">let</span> h = date.getHours();</span><br><span class="line">  <span class="keyword">let</span> minute = date.getMinutes();</span><br><span class="line">  minute = minute &lt; <span class="number">10</span> ? (<span class="string">'0'</span> + minute) : minute;</span><br><span class="line">  <span class="keyword">let</span> second = date.getSeconds();</span><br><span class="line">  second = second &lt; <span class="number">10</span> ? (<span class="string">'0'</span> + second) : second;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> y + <span class="string">"-"</span> + m + <span class="string">"-"</span> + d + <span class="string">" "</span> + h + <span class="string">":"</span> + minute + <span class="string">":"</span> + second;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//1497235419</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getRemainingimeDistance2</span>(<span class="params">distance: Number</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> time = distance;</span><br><span class="line">  <span class="keyword">let</span> days = <span class="built_in">Math</span>.floor(time / (<span class="number">24</span> * <span class="number">3600</span> * <span class="number">1000</span>));</span><br><span class="line">  <span class="keyword">let</span> temp1 = time % (<span class="number">24</span> * <span class="number">3600</span> * <span class="number">1000</span>);</span><br><span class="line">  <span class="keyword">let</span> hours = <span class="built_in">Math</span>.floor(temp1 / (<span class="number">3600</span> * <span class="number">1000</span>));</span><br><span class="line">  <span class="keyword">let</span> temp2 = temp1 % (<span class="number">3600</span> * <span class="number">1000</span>);</span><br><span class="line">  <span class="keyword">let</span> minutes = <span class="built_in">Math</span>.floor(temp2 / (<span class="number">60</span> * <span class="number">1000</span>));</span><br><span class="line">  <span class="keyword">if</span> (time &lt;= <span class="number">60</span> * <span class="number">1000</span>) &#123;</span><br><span class="line">      minutes = <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> temp3 = temp2 % (<span class="number">60</span> * <span class="number">1000</span>);</span><br><span class="line">  <span class="keyword">let</span> seconds = <span class="built_in">Math</span>.round(temp3 / <span class="number">1000</span>);</span><br><span class="line">  <span class="keyword">return</span> [hours, minutes];<span class="comment">//["0", "0", "2", "7", "33", "30"]0年0月2日 7时33分30秒</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 存储</span></span><br><span class="line"><span class="comment">* @param key</span></span><br><span class="line"><span class="comment">* @param value</span></span><br><span class="line"><span class="comment">* @param successCallback</span></span><br><span class="line"><span class="comment">* @param errorCallback</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">saveAsyncStorage</span>(<span class="params">key, value, successCallback, errorCallback</span>) </span>&#123;</span><br><span class="line">  AsyncStorage.setItem(key, value, error =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (error) &#123;</span><br><span class="line">          errorCallback(error);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">          successCallback();</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 取值</span></span><br><span class="line"><span class="comment">* @param key</span></span><br><span class="line"><span class="comment">* @param successCallback</span></span><br><span class="line"><span class="comment">* @param errorCallback</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getAsyncStorage</span>(<span class="params">key, successCallback, errorCallback</span>) </span>&#123;</span><br><span class="line">  AsyncStorage.getItem(key, (error, result) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (error) &#123;</span><br><span class="line">          errorCallback(error);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">          successCallback(result);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 删除对应key的</span></span><br><span class="line"><span class="comment">* @param key</span></span><br><span class="line"><span class="comment">* @param successCallback</span></span><br><span class="line"><span class="comment">* @param errorCallback</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">removeAsyncStorage</span>(<span class="params">key, successCallback, errorCallback</span>) </span>&#123;</span><br><span class="line">  AsyncStorage.getItem(key, error =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (error) &#123;</span><br><span class="line">          errorCallback(error);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">          successCallback();</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://leviduan.com/2020/01/08/2020-01-08-7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Levi Duan">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Levi's blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/08/2020-01-08-7/" itemprop="url">React native network library - Axios</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-01-08T22:49:01+08:00">
                2020-01-08
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web/" itemprop="url" rel="index">
                    <span itemprop="name">web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/01/08/2020-01-08-7/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020/01/08/2020-01-08-7/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>How to use axios in React Native</p>
<h3 id="Axios-Interceptors"><a href="#Axios-Interceptors" class="headerlink" title="Axios Interceptors"></a>Axios Interceptors</h3><p>Axios interceptors allow us to run code or modify the request and response before the request and response is started.</p>
<p>In simple words, it allows you write or execute a piece of your code before the request gets sent.</p>
<h3 id="Write-into-a-file-to-package-Axios"><a href="#Write-into-a-file-to-package-Axios" class="headerlink" title="Write into a file to package Axios"></a>Write into a file to package Axios</h3><p>The simple example: </p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span>;</span><br><span class="line"></span><br><span class="line">axios.defaults.retry = <span class="number">4</span>;</span><br><span class="line">axios.defaults.timeout = <span class="number">10000</span>;</span><br><span class="line">axios.defaults.headers.common[<span class="string">'x-dejafashion-ua'</span>] = <span class="string">' '</span></span><br><span class="line">axios.defaults.headers.common[<span class="string">'uid'</span>] = <span class="string">'0'</span></span><br><span class="line">axios.defaults.headers.common[<span class="string">'User-Agent'</span>] = <span class="string">'iphone ... CFNetwork/1098.7 Darwin/19.0.0'</span></span><br><span class="line"></span><br><span class="line">axios.defaults.headers.post[<span class="string">'Content-Type'</span>] = <span class="string">'application/json;charset=UTF-8'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> stylepedia_DT = <span class="string">'https://cloud-dt.co/'</span></span><br><span class="line"><span class="keyword">const</span> stylepedia_DP = <span class="string">'http://cloud-dp.co/'</span></span><br><span class="line"><span class="keyword">const</span> stylepedia_PR = <span class="string">'https://cloud.co/'</span></span><br><span class="line"></span><br><span class="line">axios.interceptors.response.use(<span class="literal">undefined</span>, <span class="function"><span class="keyword">function</span> <span class="title">axiosRetryInterceptor</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> config = err.config;</span><br><span class="line">  <span class="comment">// If config does not exist or the retry option is not set, reject</span></span><br><span class="line">  <span class="keyword">if</span>(!config || !config.retry) <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(err);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// Set the variable for keeping track of the retry count</span></span><br><span class="line">  config.__retryCount = config.__retryCount || <span class="number">0</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// Check if we've maxed out the total number of retries</span></span><br><span class="line">  <span class="keyword">if</span>(config.__retryCount &gt;= config.retry) &#123;</span><br><span class="line">      <span class="comment">// Reject with the error</span></span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(err);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// Increase the retry count</span></span><br><span class="line">  config.__retryCount += <span class="number">1</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// Create new promise to handle exponential backoff</span></span><br><span class="line">  <span class="keyword">var</span> backoff = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve</span>) </span>&#123;</span><br><span class="line">      setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">          resolve();</span><br><span class="line">      &#125;, config.retryDelay || <span class="number">1</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// Return the promise in which recalls axios to retry the request</span></span><br><span class="line">  <span class="keyword">return</span> backoff.then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> axios(config);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> axios.create(&#123;</span><br><span class="line">  baseURL: stylepedia_DP</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="You-can-use-this-file-to-send-a-Get-request"><a href="#You-can-use-this-file-to-send-a-Get-request" class="headerlink" title="You can use this file to send a Get request"></a>You can use this file to send a Get request</h3><p>if you want bring params, don’t forget to use <code>params</code> dictionary to add params</p>
<p>For example:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> API <span class="keyword">from</span> <span class="string">'../../Network/api'</span></span><br><span class="line"></span><br><span class="line">    searchInfluencersRequest() &#123;</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">            influencerLoading: <span class="literal">true</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">        API.get(<span class="string">'search/influencers'</span>, &#123;</span><br><span class="line">            params: &#123;</span><br><span class="line">                key: <span class="keyword">this</span>.state.searchText,</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        </span><br><span class="line">            <span class="keyword">if</span> (res.data.ret === <span class="number">0</span> &amp;&amp; res.data.data !== <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">                    influencerArray: res.data.data.infuencer_item_list,</span><br><span class="line">                    influencerLoading: <span class="literal">false</span>,</span><br><span class="line">                &#125;)             </span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">this</span>.setState(&#123; </span><br><span class="line">                    influencerArray: [],</span><br><span class="line">                    influencerLoading: <span class="literal">false</span>,</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).catch(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">                influencerArray: [],</span><br><span class="line">                influencerLoading: <span class="literal">false</span>,</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="You-can-use-this-file-to-send-a-Post-request"><a href="#You-can-use-this-file-to-send-a-Post-request" class="headerlink" title="You can use this file to send a Post request"></a>You can use this file to send a Post request</h3><p>Send a Post request, the way is really similar to Get request</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">likeStatusRequest(likeStatus, street_id) &#123;</span><br><span class="line">    API.post(<span class="string">'favourite/favourite_status'</span>, &#123;</span><br><span class="line">      street_id: street_id,</span><br><span class="line">      like: likeStatus ? <span class="number">1</span> : <span class="number">0</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">      .then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        likeStatus</span><br><span class="line">          ? Toast.show(<span class="string">'Added to Favourites'</span>, &#123;</span><br><span class="line">              position: Toast.positions.CENTER,</span><br><span class="line">            &#125;)</span><br><span class="line">          : Toast.show(<span class="string">'Removed from Favourites'</span>, &#123;</span><br><span class="line">              position: Toast.positions.CENTER,</span><br><span class="line">            &#125;);</span><br><span class="line">      &#125;)</span><br><span class="line">      .catch(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(error);</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h3 id="Sometimes-you-want-change-defaults-header"><a href="#Sometimes-you-want-change-defaults-header" class="headerlink" title="Sometimes you want change defaults header"></a>Sometimes you want change defaults header</h3><p>You can do it like this:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">API.defaults.headers.common[<span class="string">'uid'</span>] = global.uid;</span><br><span class="line">API.defaults.headers.common[<span class="string">'sig'</span>] = global.sig;</span><br></pre></td></tr></table></figure>
<h3 id="How-to-send-an-image-to-server？"><a href="#How-to-send-an-image-to-server？" class="headerlink" title="How to send an image to server？"></a>How to send an image to server？</h3><p>You need to new a FormData to add your image path 、image type and image rename.</p>
<p>don’t forget to change your ‘Content-Type’ headers.</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">uploadImageRequest() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> formData = <span class="keyword">new</span> FormData();</span><br><span class="line">    <span class="keyword">let</span> file = &#123;<span class="attr">uri</span>: ../.../levi.png, <span class="attr">type</span>: <span class="string">'multipart/form-data'</span>, <span class="attr">name</span>: <span class="string">'image.png'</span>&#125;;   </span><br><span class="line">    formData.append(<span class="string">"file"</span>,file);  </span><br><span class="line">    <span class="keyword">let</span> config = &#123;</span><br><span class="line">        headers:&#123;<span class="string">'Content-Type'</span>:<span class="string">'multipart/form-data'</span>&#125;</span><br><span class="line">    &#125;; </span><br><span class="line">    API.post(<span class="string">'customer/upload'</span>,formData,config)</span><br><span class="line">      .then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">            imageResponseUrl: res.data.url,</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">      .catch(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(error);</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">            isLookLoading: <span class="literal">false</span>,</span><br><span class="line">            noRequest: <span class="literal">false</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://leviduan.com/2020/01/08/2020-01-08-5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Levi Duan">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Levi's blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/08/2020-01-08-5/" itemprop="url">React native - AsyncStorage</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-01-08T22:48:01+08:00">
                2020-01-08
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web/" itemprop="url" rel="index">
                    <span itemprop="name">web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/01/08/2020-01-08-5/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020/01/08/2020-01-08-5/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Sometimes we have to use some ways to save data to the disk. Just like login status, React Native Async Storage is an asynchronous, unencrypted, persistent, key-value storage system for React Native, It’s used for a variety of scenarios but mainly to store data when your app is not using any cloud services, or when you want to implement features in your app that require data storage.</p>
<p>As a React Native developer, you have to know what these limitations are. One limitation of an AsyncStorage API is that on Android the size of the database is set to a default of 6MB limit. Also, AsyncStorage storage is based on SQLite.</p>
<p>On iOS, AsyncStorage is backed by native code that stores small values in a Serialized dictionary and larger values in separate files. On Android, AsyncStorage will use either RocksDB or SQLite based on what is available.</p>
<p>Thus, it’s important to keep SQLite limitations in mind, too. Also, it’s hard to store complex and nested data structures in the form of key-value pairs. Knowing about these limitations will help you to opt for the best solution when developing a mobile app.</p>
<p>I write some simple example for using AsyncStorage Library.</p>
<p>Github website: <a href="https://github.com/react-native-community/async-storage" target="_blank" rel="noopener">https://github.com/react-native-community/async-storage</a></p>
<h3 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">yarn add @react-native-community/async-storage</span><br><span class="line">react-native link @react-native-community/async-storage</span><br><span class="line"></span><br><span class="line">cd ios/ &amp;&amp; pod install</span><br></pre></td></tr></table></figure>
<h3 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h3><h4 id="Store-data"><a href="#Store-data" class="headerlink" title="Store data"></a>Store data</h4><p>The function is going to save the data. In the below snippet, you’ll find that it uses a parameter name, which, on success, is the value that’s stored. An alert message will be shown when the input data is saved.</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">storeData = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> AsyncStorage.setItem(<span class="string">'@storage_Key'</span>, <span class="string">'stored value'</span>)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="comment">// saving error</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">save = <span class="keyword">async</span> name =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">await</span> AsyncStorage.setItem(STORAGE_KEY, name)</span><br><span class="line">      alert(<span class="string">'Data successfully saved!'</span>)</span><br><span class="line">      <span class="keyword">this</span>.setState(&#123; name &#125;)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      alert(<span class="string">'Failed to save name.'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h4 id="Read-data"><a href="#Read-data" class="headerlink" title="Read data"></a>Read data</h4><p>There are three asynchronous methods that will help to store the data, retrieve the data, and clear the app data that are stored. Each of these methods is going to utilize the appropriate API method from the AsyncStorage API. Every method in the AsyncStorage API is promise-based; hence, let’s use async/await syntax to follow best practices.</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">getData = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> value = <span class="keyword">await</span> AsyncStorage.getItem(<span class="string">'@storage_Key'</span>)</span><br><span class="line">    <span class="keyword">if</span>(value !== <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="comment">// value previously stored</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">catch</span>(e) &#123;</span><br><span class="line">    <span class="comment">// error reading value</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">retrieveData = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> name = <span class="keyword">await</span> AsyncStorage.getItem(STORAGE_KEY)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (name !== <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123; name &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      alert(<span class="string">'Failed to load name.'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h4 id="Remove-Everything"><a href="#Remove-Everything" class="headerlink" title="Remove Everything"></a>Remove Everything</h4><p>you are going to utilize from the AsyncStorage API is called clear(). This deletes everything that is previously saved. It is not recommended to use this method directly if you want to delete only a specific item from the storage. </p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">removeEverything = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">await</span> AsyncStorage.clear()</span><br><span class="line">      alert(<span class="string">'Storage successfully cleared!'</span>)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      alert(<span class="string">'Failed to clear the async storage.'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>Mostly I use it store global object , for example:</p>
<p>the global object file:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">global.js</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> global = &#123;</span><br><span class="line">    authorization: <span class="literal">null</span>,</span><br><span class="line">    token:<span class="string">''</span>,</span><br><span class="line">    uid: <span class="number">0</span>,</span><br><span class="line">    sig: <span class="string">''</span>,</span><br><span class="line">    name: <span class="string">''</span>,</span><br><span class="line">    avatar: <span class="string">''</span>,</span><br><span class="line">    email: <span class="string">''</span>,</span><br><span class="line">    loginStatus: <span class="literal">false</span>,</span><br><span class="line">    emailFillText: <span class="string">''</span>,</span><br><span class="line">    cacheArray: [],</span><br><span class="line">    historyArray: [],</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">module</span>.exports = global;</span><br></pre></td></tr></table></figure>
<p>I read global data by this way: </p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> AsyncStorage <span class="keyword">from</span> <span class="string">'@react-native-community/async-storage'</span>;</span><br><span class="line"></span><br><span class="line">AsyncStorage.getItem(<span class="string">'@global'</span>, (errs, result) =&gt; &#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (!errs) &#123;</span><br><span class="line">        <span class="keyword">if</span> (result !== <span class="literal">null</span>) &#123;</span><br><span class="line">          <span class="keyword">var</span> jsonValue = <span class="built_in">JSON</span>.parse(result);</span><br><span class="line">          <span class="keyword">let</span> global = <span class="built_in">require</span>(<span class="string">'../../../global'</span>);</span><br><span class="line">          global.uid = jsonValue.uid;</span><br><span class="line">          global.sig = jsonValue.sig;</span><br><span class="line">          global.name = jsonValue.name;</span><br><span class="line">          global.avatar = jsonValue.avatar;</span><br><span class="line">          global.email = jsonValue.email;</span><br><span class="line">          global.loginStatus = jsonValue.loginStatus;</span><br><span class="line">          global.cacheArray = jsonValue.cacheArray;</span><br><span class="line">          global.emailFillText =  jsonValue.emailFillText</span><br><span class="line">          global.historyArray = jsonValue.historyArray</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">this</span>.requestGuestNetwork();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.requestGuestNetwork();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
<p>I store data by this way: </p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> global = <span class="built_in">require</span>(<span class="string">'../../../global'</span>);</span><br><span class="line">global.uid = res.data.uid ? res.data.uid : <span class="number">0</span>;</span><br><span class="line">global.sig = <span class="string">''</span>;</span><br><span class="line">global.name = <span class="string">''</span>;</span><br><span class="line">global.email = <span class="string">''</span>;</span><br><span class="line">global.avatar = <span class="string">''</span>;</span><br><span class="line">global.loginStatus = <span class="literal">false</span>;</span><br><span class="line">API.defaults.headers.common[<span class="string">'uid'</span>] = global.uid;</span><br><span class="line">API.defaults.headers.common[<span class="string">'sig'</span>] = global.sig;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> jsonStr = <span class="built_in">JSON</span>.stringify(global);</span><br><span class="line"></span><br><span class="line">AsyncStorage.setItem(<span class="string">'@global'</span>, jsonStr, <span class="function"><span class="keyword">function</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (error) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(error);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>That’s all</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://leviduan.com/2020/01/08/2020-01-08-6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Levi Duan">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Levi's blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/08/2020-01-08-6/" itemprop="url">React native - ActionSheetIOS</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-01-08T22:48:01+08:00">
                2020-01-08
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web/" itemprop="url" rel="index">
                    <span itemprop="name">web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/01/08/2020-01-08-6/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020/01/08/2020-01-08-6/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Sometime, We need to make a actionsheet on Rect native，so the best way to do it by ActionSheetIOS API from react-native, however, ActionSheetIOS can not be used in Android mobile. so we need an unofficial library from github to achieve an Android ActionSheet UI.</p>
<p>choosing the github library from <code>beefe/react-native-actionsheet</code></p>
<p>website: <a href="https://github.com/beefe/react-native-actionsheet/" target="_blank" rel="noopener">https://github.com/beefe/react-native-actionsheet/</a></p>
<p>Cross platform ActionSheet, This component implements a custom ActionSheet and provides the same way to drawing it on the different platforms (iOS and Android). Actually, In order to keep the best effect, it still uses the ActionSheetIOS on iOS.</p>
<p><img src="https://raw.githubusercontent.com/beefe/react-native-actionsheet/master/docs/ios-native.png" alt="iOS png"></p>
<h3 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h3><p>npm install react-native-actionsheet –save</p>
<h3 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> ActionSheet <span class="keyword">from</span> <span class="string">'react-native-actionsheet'</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Demo</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  showActionSheet = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.ActionSheet.show()</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;View&gt;</span><br><span class="line">        &lt;Text onPress=&#123;<span class="keyword">this</span>.showActionSheet&#125;&gt;Open ActionSheet&lt;<span class="regexp">/Text&gt;</span></span><br><span class="line"><span class="regexp">        &lt;ActionSheet</span></span><br><span class="line"><span class="regexp">          ref=&#123;o =&gt; this.ActionSheet = o&#125;</span></span><br><span class="line"><span class="regexp">          title=&#123;'Which one do you like ?'&#125;</span></span><br><span class="line"><span class="regexp">          options=&#123;['Apple', 'Banana', 'cancel']&#125;</span></span><br><span class="line"><span class="regexp">          cancelButtonIndex=&#123;2&#125;</span></span><br><span class="line"><span class="regexp">          destructiveButtonIndex=&#123;1&#125;</span></span><br><span class="line"><span class="regexp">          onPress=&#123;(index) =&gt; &#123; /</span>* <span class="keyword">do</span> something *<span class="regexp">/ &#125;&#125;</span></span><br><span class="line"><span class="regexp">        /</span>&gt;</span><br><span class="line">      &lt;<span class="regexp">/View&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="My-Example"><a href="#My-Example" class="headerlink" title="My Example"></a>My Example</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> ActionSheet <span class="keyword">from</span> <span class="string">'react-native-actionsheet'</span></span><br><span class="line"></span><br><span class="line">showActionSheet = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.ActionSheet.show()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">componentDidMount() &#123;</span><br><span class="line">    <span class="keyword">this</span>.props.navigation.setParams(&#123; <span class="attr">increaseCount</span>: <span class="keyword">this</span>.showActionSheet &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;ActionSheet</span><br><span class="line">      ref=&#123;o =&gt; <span class="keyword">this</span>.ActionSheet = o&#125;</span><br><span class="line">      options=&#123;[<span class="string">'Similar items'</span>, <span class="string">'Similar looks'</span>, <span class="string">'Cancel'</span>]&#125;</span><br><span class="line">      cancelButtonIndex=&#123;<span class="number">2</span>&#125;</span><br><span class="line">      destructiveButtonIndex=&#123;<span class="number">5</span>&#125;</span><br><span class="line">      onPress=&#123;(index) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (index === <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.props.navigation.setParams(&#123; <span class="attr">otherParam</span>: <span class="string">'Similar items'</span> &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (index === <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.props.navigation.setParams(&#123; <span class="attr">otherParam</span>: <span class="string">'Similar looks'</span> &#125;)</span><br><span class="line">            <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">                similarLooks: <span class="literal">true</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            () =&gt; &#123;</span><br><span class="line">                <span class="comment">// do something in here</span></span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;&#125;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>
<h3 id="PS"><a href="#PS" class="headerlink" title="PS"></a>PS</h3><p>If you don’t need the destructive ( red font ), you should write code <code>destructiveButtonIndex={value}</code> the value that you didn’t write in the options.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://leviduan.com/2020/01/08/2020-01-08-4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Levi Duan">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Levi's blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/01/08/2020-01-08-4/" itemprop="url">React native network library - Axios</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-01-08T22:47:04+08:00">
                2020-01-08
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web/" itemprop="url" rel="index">
                    <span itemprop="name">web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/01/08/2020-01-08-4/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020/01/08/2020-01-08-4/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>How to use axios in React Native</p>
<h3 id="Axios-Interceptors"><a href="#Axios-Interceptors" class="headerlink" title="Axios Interceptors"></a>Axios Interceptors</h3><p>Axios interceptors allow us to run code or modify the request and response before the request and response is started.</p>
<p>In simple words, it allows you write or execute a piece of your code before the request gets sent.</p>
<h3 id="Write-into-a-file-to-package-Axios"><a href="#Write-into-a-file-to-package-Axios" class="headerlink" title="Write into a file to package Axios"></a>Write into a file to package Axios</h3><p>The simple example: </p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span>;</span><br><span class="line"></span><br><span class="line">axios.defaults.retry = <span class="number">4</span>;</span><br><span class="line">axios.defaults.timeout = <span class="number">10000</span>;</span><br><span class="line">axios.defaults.headers.common[<span class="string">'x-dejafashion-ua'</span>] = <span class="string">' '</span></span><br><span class="line">axios.defaults.headers.common[<span class="string">'uid'</span>] = <span class="string">'0'</span></span><br><span class="line">axios.defaults.headers.common[<span class="string">'User-Agent'</span>] = <span class="string">'iphone ... CFNetwork/1098.7 Darwin/19.0.0'</span></span><br><span class="line"></span><br><span class="line">axios.defaults.headers.post[<span class="string">'Content-Type'</span>] = <span class="string">'application/json;charset=UTF-8'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> stylepedia_DT = <span class="string">'https://cloud-dt.co/'</span></span><br><span class="line"><span class="keyword">const</span> stylepedia_DP = <span class="string">'http://cloud-dp.co/'</span></span><br><span class="line"><span class="keyword">const</span> stylepedia_PR = <span class="string">'https://cloud.co/'</span></span><br><span class="line"></span><br><span class="line">axios.interceptors.response.use(<span class="literal">undefined</span>, <span class="function"><span class="keyword">function</span> <span class="title">axiosRetryInterceptor</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> config = err.config;</span><br><span class="line">  <span class="comment">// If config does not exist or the retry option is not set, reject</span></span><br><span class="line">  <span class="keyword">if</span>(!config || !config.retry) <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(err);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// Set the variable for keeping track of the retry count</span></span><br><span class="line">  config.__retryCount = config.__retryCount || <span class="number">0</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// Check if we've maxed out the total number of retries</span></span><br><span class="line">  <span class="keyword">if</span>(config.__retryCount &gt;= config.retry) &#123;</span><br><span class="line">      <span class="comment">// Reject with the error</span></span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(err);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// Increase the retry count</span></span><br><span class="line">  config.__retryCount += <span class="number">1</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// Create new promise to handle exponential backoff</span></span><br><span class="line">  <span class="keyword">var</span> backoff = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve</span>) </span>&#123;</span><br><span class="line">      setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">          resolve();</span><br><span class="line">      &#125;, config.retryDelay || <span class="number">1</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// Return the promise in which recalls axios to retry the request</span></span><br><span class="line">  <span class="keyword">return</span> backoff.then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> axios(config);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> axios.create(&#123;</span><br><span class="line">  baseURL: stylepedia_DP</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="You-can-use-this-file-to-send-a-Get-request"><a href="#You-can-use-this-file-to-send-a-Get-request" class="headerlink" title="You can use this file to send a Get request"></a>You can use this file to send a Get request</h3><p>if you want bring params, don’t forget to use <code>params</code> dictionary to add params</p>
<p>For example:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> API <span class="keyword">from</span> <span class="string">'../../Network/api'</span></span><br><span class="line"></span><br><span class="line">    searchInfluencersRequest() &#123;</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">            influencerLoading: <span class="literal">true</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">        API.get(<span class="string">'search/influencers'</span>, &#123;</span><br><span class="line">            params: &#123;</span><br><span class="line">                key: <span class="keyword">this</span>.state.searchText,</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        </span><br><span class="line">            <span class="keyword">if</span> (res.data.ret === <span class="number">0</span> &amp;&amp; res.data.data !== <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">                    influencerArray: res.data.data.infuencer_item_list,</span><br><span class="line">                    influencerLoading: <span class="literal">false</span>,</span><br><span class="line">                &#125;)             </span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">this</span>.setState(&#123; </span><br><span class="line">                    influencerArray: [],</span><br><span class="line">                    influencerLoading: <span class="literal">false</span>,</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).catch(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">                influencerArray: [],</span><br><span class="line">                influencerLoading: <span class="literal">false</span>,</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="You-can-use-this-file-to-send-a-Post-request"><a href="#You-can-use-this-file-to-send-a-Post-request" class="headerlink" title="You can use this file to send a Post request"></a>You can use this file to send a Post request</h3><p>Send a Post request, the way is really similar to Get request</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">likeStatusRequest(likeStatus, street_id) &#123;</span><br><span class="line">    API.post(<span class="string">'favourite/favourite_status'</span>, &#123;</span><br><span class="line">      street_id: street_id,</span><br><span class="line">      like: likeStatus ? <span class="number">1</span> : <span class="number">0</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">      .then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        likeStatus</span><br><span class="line">          ? Toast.show(<span class="string">'Added to Favourites'</span>, &#123;</span><br><span class="line">              position: Toast.positions.CENTER,</span><br><span class="line">            &#125;)</span><br><span class="line">          : Toast.show(<span class="string">'Removed from Favourites'</span>, &#123;</span><br><span class="line">              position: Toast.positions.CENTER,</span><br><span class="line">            &#125;);</span><br><span class="line">      &#125;)</span><br><span class="line">      .catch(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(error);</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h3 id="Sometimes-you-want-change-defaults-header"><a href="#Sometimes-you-want-change-defaults-header" class="headerlink" title="Sometimes you want change defaults header"></a>Sometimes you want change defaults header</h3><p>You can do it like this:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">API.defaults.headers.common[<span class="string">'uid'</span>] = global.uid;</span><br><span class="line">API.defaults.headers.common[<span class="string">'sig'</span>] = global.sig;</span><br></pre></td></tr></table></figure>
<h3 id="How-to-send-an-image-to-server？"><a href="#How-to-send-an-image-to-server？" class="headerlink" title="How to send an image to server？"></a>How to send an image to server？</h3><p>You need to new a FormData to add your image path 、image type and image rename.</p>
<p>don’t forget to change your ‘Content-Type’ headers.</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">uploadImageRequest() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> formData = <span class="keyword">new</span> FormData();</span><br><span class="line">    <span class="keyword">let</span> file = &#123;<span class="attr">uri</span>: ../.../levi.png, <span class="attr">type</span>: <span class="string">'multipart/form-data'</span>, <span class="attr">name</span>: <span class="string">'image.png'</span>&#125;;   </span><br><span class="line">    formData.append(<span class="string">"file"</span>,file);  </span><br><span class="line">    <span class="keyword">let</span> config = &#123;</span><br><span class="line">        headers:&#123;<span class="string">'Content-Type'</span>:<span class="string">'multipart/form-data'</span>&#125;</span><br><span class="line">    &#125;; </span><br><span class="line">    API.post(<span class="string">'customer/upload'</span>,formData,config)</span><br><span class="line">      .then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">            imageResponseUrl: res.data.url,</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">      .catch(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(error);</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">            isLookLoading: <span class="literal">false</span>,</span><br><span class="line">            noRequest: <span class="literal">false</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar1.jpg" alt="Levi Duan">
            
              <p class="site-author-name" itemprop="name">Levi Duan</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">58</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">6</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/leviduan" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://www.reddit.com/user/leviduan" target="_blank" title="Reddit">
                      
                        <i class="fa fa-fw fa-reddit"></i>Reddit</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://medium.com/@suiyun/responses" target="_blank" title="Medium">
                      
                        <i class="fa fa-fw fa-medium"></i>Medium</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-inline">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                My Favorite
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://juejin.im/user/5a52075e6fb9a01c9d31b107/posts" title="iOS Week" target="_blank">iOS Week</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.nowcoder.com/ta/coding-interviews?page=1" title="Nowcoder" target="_blank">Nowcoder</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://leetcode.com/problemset/all/" title="Leetcode" target="_blank">Leetcode</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://dribbble.com/" title="Dribbble" target="_blank">Dribbble</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://courses.edx.org/dashboard" title="Edx" target="_blank">Edx</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
<div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-apple" aria-hidden="true"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Levi Duan</span>

  
</div>

 <span class="with-love">
    <i class="fa fa-heart" aria-hidden="true"></i>
  </span>
   <span id="busuanzi_value_site_uv"></span> visitors | <span class="with-love">
    <i class="fa fa-eye" aria-hidden="true"></i>
  </span>
  <span id="busuanzi_value_site_pv"></span> times.



        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/libs/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/libs/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/libs/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/libs/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/libs/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/libs/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  

    
      <script id="dsq-count-scr" src="https://leviduan-com.disqus.com/count.js" async></script>
    

    

  




	





  









<!-- LOCAL: You can save these files to your site and update links -->
    

<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
<script src="https://www.wenjunjiang.win/js/gitment.js"></script>

<!-- END LOCAL -->

    
      <style>
        a.gitment-editor-footer-tip { display: none; }
        .gitment-container.gitment-footer-container { display: none; }
      </style>
    

    







  





  

  

  

  
  
  
  <link rel="stylesheet" href="/libs/needsharebutton/needsharebutton.css">

  
  
  <script src="/libs/needsharebutton/needsharebutton.js"></script>

  <script>
    
      pbOptions = {};
      
          pbOptions.iconStyle = "box";
      
          pbOptions.boxForm = "horizontal";
      
          pbOptions.position = "bottomCenter";
      
          pbOptions.networks = "Twitter,Facebook,Reddit,Weibo";
      
      new needShareButton('#needsharebutton-postbottom', pbOptions);
    
    
  </script>

  

  

  

  

</body>
</html>
